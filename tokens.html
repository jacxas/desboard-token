<!doctype html> <html lang="es"> <head> <meta charset="utf-8"/> <meta name="viewport" content="width=device-width,initial-scale=1"/> <title>Suite de Tokens — One‑File PWA</title> <meta name="theme-color" content="#0b0a08"/> <style> :root{--bg:#0b0a08;--card:#17130e;--border:#3a2f1f;--text:#f7d37a;--muted:#b89d62} *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text); font-family:system-ui,Segoe UI,Roboto,Arial} header{padding:20px 24px;display:flex;gap:16px;align-items:center;flex-wrap:wrap} header h1{margin:0;font-size:20px} header .actions{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap} button{background:#2a2316;color:#ffd36b;border:1px solid var(--border);border-radius:8px;padding:8px 12px;cursor:pointer} button:hover{border-color:#6b531f} .grid{display:grid;gap:16px;padding:20px;grid-template-columns:repeat(auto-fill,minmax(240px,1fr))} .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px} .head{display:flex;gap:10px;align-items:center;margin-bottom:10px} .head img{width:56px;height:56px;border-radius:8px;object-fit:cover} .meta{font-size:12px;color:var(--muted)} .badges{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px} code.small{font-size:11px;color:#e8c06a;background:#241f15;padding:2px 6px;border-radius:6px} footer{padding:20px;color:var(--muted)} </style> <!-- El manifest se inyecta dinámicamente con JS para el token seleccionado --> <link id="manifest-link" rel="manifest" href=""> </head> <body> <header> <h1>Suite de Tokens — demo en un solo HTML</h1> <div class="actions"> <button id="btn-install" hidden>Instalar PWA</button> <button id="btn-csv">Descargar CSV</button> <button id="btn-offline">Forzar cache (offline)</button> </div> </header> <main class="grid" id="grid"></main> <footer> Consejo: toca “Usar como PWA” en cualquier tarjeta para cambiar el manifest al icono/slug de ese token. Si el registro del Service Worker inline falla en tu navegador, crea un archivo sw.js con el contenido que verás en la consola. </footer> <script> /* -------------- Datos de los 10 tokens -------------- */ const TOKENS = [ { slug:'a-gov', name:'A-Gobernanza', ticker:'AGOV', img:'generated-image-2.jpg', arq:'ERC-20 + ERC20Votes + ERC20Permit; Governor + Timelock (48–72h)', uso:'Voto y delegación on-chain; cambios de parámetros y ejecuciones diferidas', riesgos:'Captura de votos, flash-loans, propuestas maliciosas', mitig:'Quórum/umbral, votingDelay/Period, simulación previa, Timelock, multisig/guardian' }, { slug:'a-uti', name:'A-Utilidad', ticker:'AUTI', img:'generated-image-1.jpg', arq:'ERC-20 + Permit (EIP-2612) + Pausable + roles MINTER/BURNER', uso:'Pago de fees, gating de features, suscripciones/bonificaciones', riesgos:'Phishing de firmas, approvals ilimitados, pausas abusivas', mitig:'Firmas EIP-712 (dominio/nonce/exp.), límites de allowance, playbook de pausa por módulo' }, { slug:'a-pay', name:'A-Pago', ticker:'APAY', img:'generated-image-3.jpg', arq:'ERC-20 + EIP-3009 (receiveWithAuthorization) + Permit + meta-tx', uso:'Cobros POS/QR, reembolsos y lotes con relayers', riesgos:'Replay/front‑running de autorizaciones, dependencia de relayers', mitig:'Validar nonce/exp./chainId, idempotencia (requestId), listas de relayers y rate‑limits' }, { slug:'a-res', name:'A-Reserva', ticker:'ARES', img:'generated-image.jpg', arq:'ERC‑20 + ERC‑4626 (vault 1:1) + attestations de reservas', uso:'Peg/reserva, colateral y par de cotización', riesgos:'Depeg, corrida de redención, riesgo de custodio/oráculo', mitig:'Activos líquidos, caps/throttling, buffers, oráculos redundantes, pruebas de reserva' }, { slug:'a1-gov', name:'A1-Gobernanza', ticker:'A1GOV', img:'generated-image-4.jpg', arq:'ERC‑20 + ERC20Votes; Governor por dominio A1 + Timelock (≥72h)', uso:'Gobierno de productos/módulos A1', riesgos:'Baja participación, concentración por serie', mitig:'Delegación incentivada, quórums diferenciados, voto off‑chain con verificación on‑chain' }, { slug:'a1-uti', name:'A1-Utilidad', ticker:'A1UTI', img:'generated-image-6.jpg', arq:'ERC‑20 + Permit + Pausable; límites por contrato/usuario', uso:'Tarifas y licencias API del vertical A1', riesgos:'Abuso de descuentos, pausas amplias', mitig:'Rate‑limits, pausas granulares por módulo, auditorías y alertas' }, { slug:'a1-pay', name:'A1-Pago', ticker:'A1PAY', img:'generated-image-5.jpg', arq:'ERC‑20 + EIP‑3009 + Permit; hooks de checkout', uso:'Pagos web2.5/QR y devoluciones A1', riesgos:'Colas/caídas de relayers, reembolsos inconsistentes', mitig:'SLAs de relayers, reintentos idempotentes, límites por ticket y alertas' }, { slug:'ax-gov', name:'AX-Gobernanza', ticker:'AXGOV', img:'generated-image-9.jpg', arq:'ERC-20 + Votes; Timelock (≥72h) + guardian limitado', uso:'Parámetros de interoperabilidad/experimentos AX', riesgos:'Cambios agresivos, forks accidentales', mitig:'Canary deploys, ventanas largas, veto/guardian acotado, auditorías' }, { slug:'ax-pay', name:'AX-Pago', ticker:'AXPAY', img:'generated-image-8.jpg', arq:'ERC‑20 + EIP‑3009; ruteo multi‑red/bridge', uso:'Pagos multi‑chain con dominios EIP‑712 por red', riesgos:'Fallas de puente, confusión de dominio de firma', mitig:'Firmas por chainId, caps por ruta, pausas por red y reconciliación de eventos' }, { slug:'ax-res', name:'AX-Reserva', ticker:'AXRES', img:'generated-image-7.jpg', arq:'ERC‑20 + ERC‑4626 multi‑pool; reconciliación cross‑chain', uso:'Reserva/peg para AX con balances por cadena', riesgos:'Desvíos entre cadenas, latencia de oráculos/puentes', mitig:'Reconciliación periódica, buffers por red, oráculos redundantes y alertas' } ]; /* -------------- Render de tarjetas -------------- */ const grid = document.getElementById('grid'); function card(t){ return ` <div class="card"> <div class="head"> <img src="${t.img}" alt="${t.name}"> <div> <div><strong>${t.name}</strong> <small class="meta">(${t.ticker})</small></div> <div class="meta">/tokens/${t.slug}</div> </div> </div> <div class="meta"><strong>Arquitectura:</strong> ${t.arq}</div> <div class="meta" style="margin-top:6px"><strong>Uso:</strong> ${t.uso}</div> <div class="meta" style="margin-top:6px"><strong>Riesgos:</strong> ${t.riesgos}</div> <div class="meta" style="margin-top:6px"><strong>Mitigaciones:</strong> ${t.mitig}</div> <div class="badges" style="margin-top:10px"> <button onclick="useAsPWA('${t.slug}')">Usar como PWA</button> <button onclick="cacheToken('${t.slug}')">Cachear icono</button> </div> </div>`; } grid.innerHTML = TOKENS.map(card).join(''); /* -------------- Manifest dinámico -------------- */ const manifestLink = document.getElementById('manifest-link'); function buildManifestFor(slug){ const t = TOKENS.find(x=>x.slug===slug) || TOKENS; return { name: t.name, short_name: t.ticker, start_url: "/", display: "standalone", background_color: "#0b0a08", theme_color: "#0b0a08", icons: [ { src: t.img, sizes: "192x192", type: "image/jpeg", purpose: "any" }, { src: t.img, sizes: "512x512", type: "image/jpeg", purpose: "any" } ] }; } function useAsPWA(slug){ const obj = buildManifestFor(slug); const blob = new Blob([JSON.stringify(obj)], {type:'application/manifest+json'}); const url = URL.createObjectURL(blob); manifestLink.href = url; localStorage.setItem('manifestSlug', slug); alert(`Manifest activo: ${slug}. Usa “Añadir a pantalla de inicio” para instalar.`); } // activar uno por defecto useAsPWA(localStorage.getItem('manifestSlug') || 'ax-pay'); /* -------------- CSV descarga -------------- */ document.getElementById('btn-csv').onclick = () => { const header = ['Nombre','Ticker','Arquitectura','Uso','Riesgos','Mitigaciones','Icono']; const rows = TOKENS.map(t=>[ t.name,t.ticker,t.arq,t.uso,t.riesgos,t.mitig,t.slug ].map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')); const csv = `${header.join(',')}\n${rows.join('\n')}\n`; const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([csv],{type:'text/csv'})); a.download = 'tokens_tecnico.csv'; a.click(); }; /* -------------- Service Worker inline (best‑effort) -------------- */ let deferredPrompt; window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferredPrompt = e; document.getElementById('btn-install').hidden = false; }); document.getElementById('btn-install').onclick = async ()=>{ if (!deferredPrompt) return; deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt = null; document.getElementById('btn-install').hidden = true; }; async function registerSWInline() { if (!('serviceWorker' in navigator)) return; const IMGS = TOKENS.map(t=>t.img); const swCode = ` const CACHE = 'onefile-pwa-v1'; const ASSETS = ${JSON.stringify(IMGS)}; self.addEventListener('install', e=>{ e.waitUntil(caches.open(CACHE).then(c=>c.addAll(ASSETS)).then(()=>self.skipWaiting())); }); self.addEventListener('activate', e=>{ e.waitUntil(caches.keys().then(keys=>Promise.all(keys.filter(k=>k!==CACHE).map(k=>caches.delete(k)))) .then(()=>self.clients.claim())); }); self.addEventListener('fetch', e=>{ const req = e.request; // Navegaciones: network-first con fallback simple if (req.mode === 'navigate') { e.respondWith(fetch(req).catch(()=> new Response('<!doctype html><meta charset=utf-8><title>Offline</title><body style="background:#0b0a08;color:#f7d37a;font-family:system-ui;padding:24px">Sin conexión. Las imágenes e íconos siguen disponibles offline.</body>',{headers:{'Content-Type':'text/html'}}))); return; } // Imágenes y estáticos: cache-first if (req.method==='GET') { e.respondWith(caches.match(req).then(r=> r || fetch(req).then(res=>{ const copy = res.clone(); caches.open(CACHE).then(c=>c.put(req, copy)); return res; }))); } }); `; try { // Nota: algunos navegadores no permiten SW desde blob:. Si falla, mostramos el contenido. const url = URL.createObjectURL(new Blob([swCode], {type:'text/javascript'})); const reg = await navigator.serviceWorker.register(url, { scope: './' }); console.log('SW registrado', reg); } catch (err) { console.warn('Fallo el registro del SW inline. Crea un archivo sw.js con este contenido:', swCode); } } registerSWInline(); /* Botón para precachear todo manualmente */ document.getElementById('btn-offline').onclick = async ()=>{ if (!navigator.serviceWorker?.controller) { alert('SW no activo aún. Recarga en 2–3s.'); return; } const imgs = TOKENS.map(t=>t.img); const cache = await caches.open('onefile-pwa-v1'); await cache.addAll(imgs); alert('Iconos/imagenes cacheados. Puedes probar offline.'); }; /* -------------- Utilidad: cache por token desde tarjeta -------------- */ async function cacheToken(slug){ const t = TOKENS.find(x=>x.slug===slug); if (!t) return; const c = await caches.open('onefile-pwa-v1'); await c.add(t.img); alert(`Cacheado: ${t.img}`); } </script> </body> </html>